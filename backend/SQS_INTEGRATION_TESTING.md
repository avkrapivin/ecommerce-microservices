# ๐งช ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั SQS ั LocalStack

## ๐ ะะฑะทะพั

ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะดะปั **SQS** ะพะฑัะฐะฑะพัะบะธ `OrderStatusUpdated` ัะพะฑััะธะน ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ LocalStack ะดะปั ัะผัะปััะธะธ AWS ัะตัะฒะธัะพะฒ. ะะบะปััะฐะตั ัะตััะธัะพะฒะฐะฝะธะต ะพัะฝะพะฒะฝะพะน ะพัะตัะตะดะธ, Dead Letter Queue, ะธ ะผะพะฝะธัะพัะธะฝะณะฐ.

## ๐๏ธ ะััะธัะตะบัััะฐ ัะตััะธัะพะฒะฐะฝะธั

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ  LocalStack โ    โ    Tests    โ    โ   Backend   โ
โ             โ    โ             โ    โ             โ
โ โโโโโโโโโโโ โ    โ โโโโโโโโโโโ โ    โ โโโโโโโโโโโ โ
โ โ   SNS   โ โโโโโค โ Publish โ โ    โ โ SQS     โ โ
โ โโโโโโโโโโโ โ    โ โ Message โ โ    โ โ Listenerโ โ
โ โโโโโโโโโโโ โ    โ โโโโโโโโโโโ โ    โ โโโโโโโโโโโ โ
โ โ   SQS   โ โโโโโค โโโโโโโโโโโ โโโโโบโ โโโโโโโโโโโ โ
โ โโโโโโโโโโโ โ    โ โ Receive โ โ    โ โ Order   โ โ
โ             โ    โ โ & Test  โ โ    โ โ Update  โ โ
โโโโโโโโโโโโโโโ    โ โโโโโโโโโโโ โ    โ โ Listenerโ โ
                   โโโโโโโโโโโโโโโ    โ โโโโโโโโโโโ โ
                                      โ โโโโโโโโโโโ โ
                                      โ โDatabase โ โ
                                      โ โโโโโโโโโโโ โ
                                      โโโโโโโโโโโโโโโ
```

## ๐ ะกัััะบัััะฐ ัะตััะพะฒ

### **1. SqsVsHttpsIntegrationTest**
**ะคะฐะนะป:** `src/test/java/com/ecommerce/shipping/integration/SqsVsHttpsIntegrationTest.java`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะคัะฝะบัะธะพะฝะฐะปัะฝะพะต ััะฐะฒะฝะตะฝะธะต SQS ะธ HTTPS ะพะฑัะฐะฑะพัะบะธ

**ะขะตััะพะฒัะต ััะตะฝะฐัะธะธ:**
- โ `shouldProcessOrderStatusUpdateViaSqs()` - ะพะฑัะฐะฑะพัะบะฐ ัะตัะตะท SQS
- โ `shouldProcessOrderStatusUpdateViaHttps()` - ะพะฑัะฐะฑะพัะบะฐ ัะตัะตะท HTTPS
- โ `shouldProduceSameResultsForSqsAndHttps()` - ััะฐะฒะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ
- โ `shouldHandleInvalidMessageInDlq()` - ะพะฑัะฐะฑะพัะบะฐ ะฝะตะบะพััะตะบัะฝัั ัะพะพะฑัะตะฝะธะน

### **2. SqsPerformanceTest**
**ะคะฐะนะป:** `src/test/java/com/ecommerce/shipping/integration/SqsPerformanceTest.java`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะขะตััะธัะพะฒะฐะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธ ะฝะฐะณััะทะบะธ

**ะขะตััะพะฒัะต ััะตะฝะฐัะธะธ:**
- โ `shouldComparePerformanceSqsVsHttps()` - ััะฐะฒะฝะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- โ `shouldHandleBurstLoad()` - ัะตััะธัะพะฒะฐะฝะธะต burst ะฝะฐะณััะทะบะธ

## ๐ ะะฐะฟััะบ ัะตััะพะฒ

### **ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ (ัะตะบะพะผะตะฝะดัะตััั)**
```bash
cd backend
chmod +x run-sqs-integration-tests.sh
./run-sqs-integration-tests.sh
```

### **ะััะฝะพะน ะทะฐะฟััะบ ะพัะดะตะปัะฝัั ัะตััะพะฒ**

#### ะคัะฝะบัะธะพะฝะฐะปัะฝัะต ัะตััั
```bash
mvn test -Dtest=SqsVsHttpsIntegrationTest -Dspring.profiles.active=test
```

#### ะขะตััั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
```bash
mvn test -Dtest=SqsPerformanceTest -Dspring.profiles.active=test
```

#### Unit ัะตััั SQS
```bash
mvn test -Dtest=OrderStatusSqsListenerTest -Dspring.profiles.active=test
```

### **ะะฐะฟััะบ ะฒัะตั ะธะฝัะตะณัะฐัะธะพะฝะฝัั ัะตััะพะฒ**
```bash
mvn test -Dtest="*IntegrationTest" -Dspring.profiles.active=test
```

## ๐ ะงัะพ ัะตััะธััะตััั

### **ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั**
| ะัะฟะตะบั | SQS | HTTPS | ะะตะทัะปััะฐั |
|--------|-----|-------|-----------|
| **ะะพััะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน** | โ ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝะฐั | โ๏ธ Best effort | SQS ะปัััะต |
| **Retry ะปะพะณะธะบะฐ** | โ ะะฒัะพะผะฐัะธัะตัะบะฐั | โ ะััะฝะฐั | SQS ะปัััะต |  
| **Dead Letter Queue** | โ ะัััะพะตะฝะฝะฐั | โ ะะตั | SQS ะปัััะต |
| **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ** | โ ะะฐะดะตะถะฝะฐั | โ๏ธ ะะฐะฒะธัะธั ะพั endpoint | SQS ะปัััะต |
| **ะัะพััะพัะฐ ัะตะฐะปะธะทะฐัะธะธ** | โ๏ธ ะกะปะพะถะฝะตะต | โ ะัะพัะต | HTTPS ะปัััะต |

### **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**
- **Latency:** ะัะตะผั ะพั ะพัะฟัะฐะฒะบะธ ะดะพ ะพะฑัะฐะฑะพัะบะธ
- **Throughput:** ะะพะปะธัะตััะฒะพ ัะพะพะฑัะตะฝะธะน ะฒ ัะตะบัะฝะดั
- **Burst handling:** ะะฑัะฐะฑะพัะบะฐ ะฟะธะบะพะฒัั ะฝะฐะณััะทะพะบ
- **Resource usage:** ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ ะธ CPU

### **ะะฐะดะตะถะฝะพััั**
- **Message durability:** ะกะพััะฐะฝะฝะพััั ัะพะพะฑัะตะฝะธะน
- **Retry mechanisms:** ะะตัะฐะฝะธะทะผั ะฟะพะฒัะพัะฝัั ะฟะพะฟััะพะบ
- **Error handling:** ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- **Monitoring:** ะะพะทะผะพะถะฝะพััะธ ะผะพะฝะธัะพัะธะฝะณะฐ

## ๐ง ะขัะตะฑะพะฒะฐะฝะธั ะบ ะพะบััะถะตะฝะธั

### **Docker**
```bash
# ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ Docker
docker --version
# Docker version 20.10.0+

# ะัะพะฒะตัะบะฐ ััะพ Docker ะทะฐะฟััะตะฝ
docker info
```

### **Java ะธ Maven**
```bash
# Java 17+
java -version

# Maven 3.6+
mvn -version
```

### **ะะฐะผััั**
- **ะะตะบะพะผะตะฝะดัะตััั:** 4GB+ RAM ะดะปั Docker
- **LocalStack:** ะธัะฟะพะปัะทัะตั ~1GB RAM
- **ะขะตััั:** ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ~512MB

## ๐ ะะฝัะตัะฟัะตัะฐัะธั ัะตะทัะปััะฐัะพะฒ

### **ะัะธะผะตั ะฒัะฒะพะดะฐ ััะฝะบัะธะพะฝะฐะปัะฝัั ัะตััะพะฒ**
```
โ shouldProcessOrderStatusUpdateViaSqs: PASSED
โ shouldProcessOrderStatusUpdateViaHttps: PASSED  
โ shouldProduceSameResultsForSqsAndHttps: PASSED
โ shouldHandleInvalidMessageInDlq: PASSED

ะะตะทัะปััะฐั: SQS ะธ HTTPS ะพะฑัะฐะฑะฐััะฒะฐัั ัะพะพะฑัะตะฝะธั ะธะดะตะฝัะธัะฝะพ โ
```

### **ะัะธะผะตั ะฒัะฒะพะดะฐ ัะตััะพะฒ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ**
```
=== Performance Comparison Results ===
Messages processed: 10
HTTPS processing time: 1250 ms
SQS processing time: 2100 ms
HTTPS avg per message: 125.0 ms
SQS avg per message: 210.0 ms
HTTPS is faster by: 850 ms

=== Burst Load Test Results ===
Burst size: 50 messages
Total processing time: 8500 ms
Average per message: 170.0 ms
Throughput: 5.88 messages/sec
```

### **ะัะธัะตัะธะธ ะดะปั ะฟัะธะฝััะธั ัะตัะตะฝะธั**

#### **ะัะฑะธัะฐะนัะต SQS ะตัะปะธ:**
- โ ะะฐะดะตะถะฝะพััั ะบัะธัะธัะฝะฐ
- โ ะะถะธะดะฐัััั ะฒััะพะบะธะต ะฝะฐะณััะทะบะธ
- โ ะัะถะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะฐั retry ะปะพะณะธะบะฐ
- โ ะะฐะถะตะฝ ะผะพะฝะธัะพัะธะฝะณ ะธ ะฐะปะตััั
- โ ะะปะฐะฝะธััะตััั scaling

#### **ะัะฑะธัะฐะนัะต HTTPS ะตัะปะธ:**
- โ ะัะพััะพัะฐ ะฒะฐะถะฝะตะต ะฝะฐะดะตะถะฝะพััะธ
- โ ะะธะทะบะธะต ะฝะฐะณััะทะบะธ (< 100 ัะพะฑััะธะน/ัะฐั)
- โ ะะธะฝะธะผะฐะปัะฝะฐั latency ะบัะธัะธัะฝะฐ
- โ ะะพะผะฐะฝะดะฐ ะฝะต ะณะพัะพะฒะฐ ะบ SQS complexity
- โ ะััััะฐั ัะฐะทัะฐะฑะพัะบะฐ ะฟัะธะพัะธัะตั

## ๐๏ธ ะะฐัััะพะนะบะฐ ะธ ะบะพะฝัะธะณััะฐัะธั

### **LocalStack ะบะพะฝัะธะณััะฐัะธั**
```java
@Container
static LocalStackContainer localstack = new LocalStackContainer(
    DockerImageName.parse("localstack/localstack:3.0"))
    .withServices(SNS, SQS);
```

### **ะขะตััะพะฒัะต ะฝะฐัััะพะนะบะธ**
```yaml
# application-test.yml
aws:
  region: us-east-1
  account-id: 820242910367
  sqs:
    order-status-update-queue-name: test-queue
    order-status-update-dlq-name: test-dlq
```

### **ะขะตััะพะฒัะต ะดะฐะฝะฝัะต**
```java
// ะกะพะทะดะฐะฝะธะต ัะตััะพะฒะพะณะพ ShippingInfo
ShippingInfo shippingInfo = new ShippingInfo();
shippingInfo.setOrderId(orderId);
shippingInfo.setStatus(ShippingStatus.PENDING);
shippingInfo.setCarrier("Test Carrier");
```

## ๐ Troubleshooting

### **Docker ะฟัะพะฑะปะตะผั**
```bash
# ะัะธััะบะฐ ะบะพะฝัะตะนะฝะตัะพะฒ
docker stop $(docker ps -q --filter "label=org.testcontainers")
docker rm $(docker ps -aq --filter "label=org.testcontainers")

# ะัะธััะบะฐ ะพะฑัะฐะทะพะฒ
docker rmi $(docker images -q localstack/localstack)
```

### **ะขะตััั ะฝะต ะทะฐะฟััะบะฐัััั**
```bash
# ะัะพะฒะตัะบะฐ ัะตััะพะฒะพะณะพ ะฟัะพัะธะปั
mvn test -Dspring.profiles.active=test -X

# ะัะธะฝัะดะธัะตะปัะฝะฐั ะฟะตัะตัะฑะพัะบะฐ
mvn clean compile test-compile
```

### **LocalStack ะฝะตะดะพัััะฟะตะฝ**
```bash
# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ LocalStack
docker logs $(docker ps -q --filter "ancestor=localstack/localstack")

# ะััะฝะพะน ะทะฐะฟััะบ LocalStack
docker run -d -p 4566:4566 localstack/localstack:3.0
```

### **ะขะตััั ะฟะฐะดะฐัั ั timeout**
```java
// ะฃะฒะตะปะธัะตะฝะธะต timeout ะฒ ัะตััะฐั
await().atMost(60, TimeUnit.SECONDS).untilAsserted(() -> {
    // ะัะพะฒะตัะบะธ
});
```

## ๐ ะงะตะบ-ะปะธัั ะฟะตัะตะด production

### **ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั**
- [ ] ะัะต ััะฝะบัะธะพะฝะฐะปัะฝัะต ัะตััั ะฟัะพัะพะดัั
- [ ] SQS ะธ HTTPS ะดะฐัั ะธะดะตะฝัะธัะฝัะต ัะตะทัะปััะฐัั
- [ ] DLQ ะบะพััะตะบัะฝะพ ะพะฑัะฐะฑะฐััะฒะฐะตั ะพัะธะฑะบะธ
- [ ] Retry ะปะพะณะธะบะฐ ัะฐะฑะพัะฐะตั ะบะฐะบ ะพะถะธะดะฐะตััั

### **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**
- [ ] Latency ะฒ ะฟัะธะตะผะปะตะผัั ะฟัะตะดะตะปะฐั (< 5 ัะตะบัะฝะด)
- [ ] Throughput ะดะพััะฐัะพัะฝัะน ะดะปั ะฝะฐะณััะทะบะธ
- [ ] Burst load ะพะฑัะฐะฑะฐััะฒะฐะตััั ะฑะตะท ะพัะธะฑะพะบ
- [ ] Memory usage ะฒ ะฝะพัะผะต

### **ะะพะฝะธัะพัะธะฝะณ**
- [ ] CloudWatch ะผะตััะธะบะธ ะฝะฐัััะพะตะฝั
- [ ] ะะปะตััั ะฝะฐ DLQ ัะพะพะฑัะตะฝะธั
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- [ ] Health checks ะฟัะพัะพะดัั

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะะฐะฟัััะธัะต ัะตััั** ะธ ะฟัะพะฐะฝะฐะปะธะทะธััะนัะต ัะตะทัะปััะฐัั
2. **ะัะฑะตัะธัะต ะฟะพะดัะพะด** ะฝะฐ ะพัะฝะพะฒะต ัะตะทัะปััะฐัะพะฒ ัะตััะธัะพะฒะฐะฝะธั
3. **ะะฑะฝะพะฒะธัะต CloudFormation** ะตัะปะธ ะฝัะถะฝั ะธะทะผะตะฝะตะฝะธั
4. **Deploy ะฒ staging** ะดะปั ัะธะฝะฐะปัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั
5. **ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ** ะฒ production ะพะบััะถะตะฝะธะธ

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ ั ัะตััะฐะผะธ:
1. ะัะพะฒะตัััะต Docker ะธ LocalStack
2. ะฃะฑะตะดะธัะตัั ััะพ ะธัะฟะพะปัะทัะตััั ัะตััะพะฒัะน ะฟัะพัะธะปั
3. ะัะพะฒะตัััะต ะปะพะณะธ TestContainers
4. ะะพะฟัะพะฑัะนัะต ะพัะธััะธัั Docker ะบะพะฝัะตะนะฝะตัั 